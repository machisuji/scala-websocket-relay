<html>
<head>
    <title>WebSocket Relay Server</title>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bulma.min.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>

<section class="hero is-warning">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">
        WebSocket Relay Server
      </h1>
      <h2 class="subtitle">
        Connects a host with clients through web sockets when the clients cannot connect to the host
        directly due to firewall restrictions. In this case the clients instead connect to this relay server.
      </h2>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">
      API
    </h1>
    <p class="subtitle">
      The Relay's API endpoints
    </p>
    <ul>
        <li>
            <span class="code">GET /</span> - This page
        </li>
        <li>
            <span class="code">GET /session[?id=&lt;id&gt;&amp;keepAlive=str] {Upgrade}</span> - WebSocket connection for the host.
            <span class="code">id</span> is an optional parameter useful when you want to reconnect to the same session.
            If ommitted a session ID will be generated.
            If <span class="code">keepAlive</span> is present <span class="code">"str"</span> is sent to the host every
            30s to make sure the connection is kept alive.
        </li>
        <li>
            <span class="code">GET /session/:id[?keepAlive=str][&amp;dummyFallback=true][&amp;client=&lt;uuid&gt;] {Upgrade}</span> - WebSocket connection for clients.
            Any messages sent to this socket will be relayed to the host which connected through
            <span class="code">/session</span> to the session with the given ID.
            If <span class="code">keepAlive</span> is present <span class="code">"str"</span> is sent to the client every
            30s to make sure the connection is kept alive.
            If <span class="code">dummyFallback</span> is true then a client can connect to a session even
            if there is none. A dummy session will be opened which will just consume messages.
        </li>
    </ul>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">
      Protocol
    </h1>
    <p class="subtitle">
      There are the following message formats used for the host-to-server communication
      (<span class="code">/session</span>).
    </p>
    <ul>
        <li>
            <span class="code">session: &lt;session-id&gt;</span> - Sent as the first message from the relay
            (this) server to the connecting host to identify the created session. The host has to give this ID to
            any clients wanting to connect to it.
        </li>
        <li>
            <span class="code">connected: &lt;client-id&gt;</span> - Sent to the host when a client connects
            to the relay.
        </li>
        <li>
            <span class="code">disconnected: &lt;client-id&gt;</span> - Sent to the host when a client
            disconnects from the relay.
        </li>
        <li>
            <span class="code">&lt;client-id&gt;: &lt;message&gt;</span> - Message from the host to the client
            with the given ID or the other way around. Meaning this is the message a host has to send to relay
            a message to a client and at the same time this is the message a host will receive if a client
            wants to relay a message to it.
            Only the <span class="code">&lt;message&gt;</span> part will be sent to the client.
        </li>
        <li>
            <span class="code">unknown: &lt;client-id&gt;</span> - Response to the host when it tried
            sending a message to an unknown client.
        </li>
        <li>
            <span class="code">invalid</span> - Sent to the host when it sent a message that the relay
            did not understand.
        </li>
    </ul>
    <h3>Client Messages</h3>
    <p>
        Messages from clients are relayed as-is to the server listening to the given session.
    </p>
  </div>
</section>

<section class="section">
    <h1 class="title">Test</h1>

    <table>
      <tr>
        <th class="host-header">Host</th>
        <th class="client-1-header">Client 1</th>
        <th class="client-2-header">Client 2</th>
      </tr>
      <tr>
        <td>
          <input id="host-input" placeholder="Input"></input>
        </td>
        <td>
          <input id="client-1-input" placeholder="input"></input>
          <button id="client-1-connect">Connect</button>
        </td>
        <td>
          <input id="client-2-input" placeholder="input"></input>
          <button id="client-2-connect">Connect</button>
        </td>
      </tr>
      <tr>
        <td>
          <div id="host-output">&nbsp;</div>
        </td>
        <td>
          <div id="client-1-output">&nbsp;</div>
        </td>
        <td>
          <div id="client-2-output">&nbsp;</div>
        </td>
      </tr>
    </table>
</section>
</body>

<script type="text/javascript">
  window.baseURL = "ws://$host:$port";
</script>
<script type="text/javascript" src="js/main.js"></script>
</html>
